(function(k,K){var x=function(m){function p(){return"/"==b.authServerUrl.charAt(b.authServerUrl.length-1)?b.authServerUrl+"realms/"+encodeURIComponent(b.realm):b.authServerUrl+"/realms/"+encodeURIComponent(b.realm)}function B(a,c){function e(d,e,l,f){g=(g+(new Date).getTime())/2;w(d,e,l,g);b.tokenParsed&&b.tokenParsed.nonce!=a.storedNonce||b.refreshTokenParsed&&b.refreshTokenParsed.nonce!=a.storedNonce||b.idTokenParsed&&b.idTokenParsed.nonce!=a.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),
b.clearToken(),c&&c.setError()):f&&(b.onAuthSuccess&&b.onAuthSuccess(),c&&c.setSuccess())}var d=a.code,l=a.error,f=a.prompt,g=(new Date).getTime();if(l)"none"!=f?(d={error:l,error_description:a.error_description},b.onAuthError&&b.onAuthError(d),c&&c.setError(d)):c&&c.setSuccess();else if("standard"!=b.flow&&(a.access_token||a.id_token)&&e(a.access_token,null,a.id_token,!0),"implicit"!=b.flow&&d){var d="code\x3d"+d+"\x26grant_type\x3dauthorization_code",l=p()+"/protocol/openid-connect/token",q=new XMLHttpRequest;
q.open("POST",l,!0);q.setRequestHeader("Content-type","application/x-www-form-urlencoded");b.clientId&&b.clientSecret?q.setRequestHeader("Authorization","Basic "+btoa(b.clientId+":"+b.clientSecret)):d+="\x26client_id\x3d"+encodeURIComponent(b.clientId);d+="\x26redirect_uri\x3d"+a.redirectUri;q.withCredentials=!0;q.onreadystatechange=function(){if(4==q.readyState)if(200==q.status){var a=JSON.parse(q.responseText);e(a.access_token,a.refresh_token,a.id_token,"standard"===b.flow)}else b.onAuthError&&
b.onAuthError(),c&&c.setError()};q.send(d)}}function J(a){var c=n(),e;m?"string"===typeof m&&(e=m):e="keycloak.json";if(e){var d=new XMLHttpRequest;d.open("GET",e,!0);d.setRequestHeader("Accept","application/json");d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status||0==d.status&&d.responseText&&d.responseURL.startsWith("file:")){var a=JSON.parse(d.responseText);b.authServerUrl=a["auth-server-url"];b.realm=a.realm;b.clientId=a.resource;b.clientSecret=(a.credentials||{}).secret;c.setSuccess()}else c.setError()};
d.send()}else{if(!m.url)for(a=document.getElementsByTagName("script"),e=0;e<a.length;e++)if(a[e].src.match(/.*keycloak\.js/)){m.url=a[e].src.substr(0,a[e].src.indexOf("/js/keycloak.js"));break}if(!m.realm)throw"realm missing";if(!m.clientId)throw"clientId missing";b.authServerUrl=m.url;b.realm=m.realm;b.clientId=m.clientId;b.clientSecret=(m.credentials||{}).secret;c.setSuccess()}return c.promise}function w(a,c,e,d){b.tokenTimeoutHandle&&(clearTimeout(b.tokenTimeoutHandle),b.tokenTimeoutHandle=null);
c?(b.refreshToken=c,b.refreshTokenParsed=C(c)):(delete b.refreshToken,delete b.refreshTokenParsed);e?(b.idToken=e,b.idTokenParsed=C(e)):(delete b.idToken,delete b.idTokenParsed);if(a){if(b.token=a,b.tokenParsed=C(a),b.sessionId=b.tokenParsed.session_state,b.authenticated=!0,b.subject=b.tokenParsed.sub,b.realmAccess=b.tokenParsed.realm_access,b.resourceAccess=b.tokenParsed.resource_access,d&&(b.timeSkew=Math.floor(d/1E3)-b.tokenParsed.iat),null!=b.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+
b.timeSkew+" seconds"),b.onTokenExpired))if(a=1E3*(b.tokenParsed.exp-(new Date).getTime()/1E3+b.timeSkew),console.info("[KEYCLOAK] Token expires in "+Math.round(a/1E3)+" s"),0>=a)b.onTokenExpired();else b.tokenTimeoutHandle=setTimeout(b.onTokenExpired,a)}else delete b.token,delete b.tokenParsed,delete b.subject,delete b.realmAccess,delete b.resourceAccess,b.authenticated=!1}function C(a){a=a.split(".")[1];a=a.replace("/-/g","+");a=a.replace("/_/g","/");switch(a.length%4){case 0:break;case 2:a+="\x3d\x3d";
break;case 3:a+="\x3d";break;default:throw"Invalid token";}a=(a+"\x3d\x3d\x3d").slice(0,a.length+a.length%4);a=a.replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(escape(atob(a)));return a=JSON.parse(a)}function I(){for(var a=[],b=0;36>b;b++)a[b]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]="4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="-";return a.join("")}function D(a){a=(new E(a,b.responseMode)).parseUri();var c=y.get(a.state);if(c&&(a.code||
a.error||a.access_token||a.id_token))return a.redirectUri=c.redirectUri,a.storedNonce=c.nonce,a.prompt=c.prompt,a.fragment&&(a.newUrl+="#"+a.fragment),a}function n(){var a={setSuccess:function(b){a.success=!0;a.result=b;a.successCallback&&a.successCallback(b)},setError:function(b){a.error=!0;a.result=b;a.errorCallback&&a.errorCallback(b)},promise:{success:function(b){a.success?b(a.result):a.error||(a.successCallback=b);return a.promise},error:function(b){a.error?b(a.result):a.success||(a.errorCallback=
b);return a.promise}}};return a}function F(){var a=n();if(!h.enable||h.iframe)return a.setSuccess(),a.promise;var c=document.createElement("iframe");h.iframe=c;c.onload=function(){var b=p();"/"===b.charAt(0)?(b=k.location.origin?k.location.origin:k.location.protocol+"//"+k.location.hostname+(k.location.port?":"+k.location.port:""),h.iframeOrigin=b):h.iframeOrigin=b.substring(0,b.indexOf("/",8));a.setSuccess();setTimeout(d,1E3*h.interval)};var e=p()+"/protocol/openid-connect/login-status-iframe.html";
b.iframeVersion&&(e=e+"?version\x3d"+b.iframeVersion);c.setAttribute("src",e);c.setAttribute("title","keycloak-session-iframe");c.style.display="none";document.body.appendChild(c);k.addEventListener("message",function(a){if(a.origin===h.iframeOrigin&&h.iframe.contentWindow===a.source&&("unchanged"==a.data||"changed"==a.data||"error"==a.data)){"unchanged"!=a.data&&b.clearToken();for(var d=h.callbackList.splice(0,h.callbackList.length),c=d.length-1;0<=c;--c){var e=d[c];"unchanged"==a.data?e.setSuccess():
e.setError()}}},!1);var d=function(){z();b.token&&setTimeout(d,1E3*h.interval)};return a.promise}function z(){var a=n();if(h.iframe&&h.iframeOrigin){var c=b.clientId+" "+b.sessionId;h.callbackList.push(a);var e=h.iframeOrigin;1==h.callbackList.length&&h.iframe.contentWindow.postMessage(c,e)}else a.setSuccess();return a.promise}function A(a){if(!a||"default"==a)return{login:function(a){k.location.href=b.createLoginUrl(a);return n().promise},logout:function(a){k.location.href=b.createLogoutUrl(a);return n().promise},
register:function(a){k.location.href=b.createRegisterUrl(a);return n().promise},accountManagement:function(){k.location.href=b.createAccountUrl();return n().promise},redirectUri:function(a,d){1==arguments.length&&(d=!0);if(a&&a.redirectUri)return a.redirectUri;if(b.redirectUri)return b.redirectUri;var c=location.href;location.hash&&d&&(c=c.substring(0,location.href.indexOf("#")),c+=(-1==c.indexOf("?")?"?":"\x26")+"redirect_fragment\x3d"+encodeURIComponent(location.hash.substring(1)));return c}};if("cordova"==
a){h.enable=!1;var c=function(a,b,c){return k.cordova&&k.cordova.InAppBrowser?k.cordova.InAppBrowser.open(a,b,c):k.open(a,b,c)};return{login:function(a){var d=n(),e="location\x3dno";a&&"none"==a.prompt&&(e+=",hidden\x3dyes");a=b.createLoginUrl(a);var f=c(a,"_blank",e),g=!1;f.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&(a=D(a.url),B(a,d),f.close(),g=!0)});f.addEventListener("loaderror",function(a){g||(0==a.url.indexOf("http://localhost")?(a=D(a.url),B(a,d),f.close(),
g=!0):(d.setError(),f.close()))});return d.promise},logout:function(a){var d=n();a=b.createLogoutUrl(a);var e=c(a,"_blank","location\x3dno,hidden\x3dyes"),f;e.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&e.close()});e.addEventListener("loaderror",function(a){0!=a.url.indexOf("http://localhost")&&(f=!0);e.close()});e.addEventListener("exit",function(a){f?d.setError():(b.clearToken(),d.setSuccess())});return d.promise},register:function(){var a=b.createRegisterUrl(),
d=c(a,"_blank","location\x3dno");d.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&d.close()})},accountManagement:function(){var a=b.createAccountUrl(),d=c(a,"_blank","location\x3dno");d.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&d.close()})},redirectUri:function(a){return"http://localhost"}}}throw"invalid adapter type: "+a;}if(!(this instanceof x))return new x(m);for(var b=this,r,u=[],y,h={enable:!0,callbackList:[],interval:5},v=
document.getElementsByTagName("script"),t=0;t<v.length;t++)-1===v[t].src.indexOf("keycloak.js")&&-1===v[t].src.indexOf("keycloak.min.js")||-1===v[t].src.indexOf("version\x3d")||(b.iframeVersion=v[t].src.substring(v[t].src.indexOf("version\x3d")+8).split("\x26")[0]);b.init=function(a){function c(){var c=function(a){a||(e.prompt="none");b.login(e).success(function(){d.setSuccess()}).error(function(){d.setError()})},e={};switch(a.onLoad){case "check-sso":h.enable?F().success(function(){z().success(function(){c(!1)}).error(function(){d.setSuccess()})}):
c(!1);break;case "login-required":c(!0);break;default:throw"Invalid value for onLoad";}}b.authenticated=!1;a:{try{y=new G;break a}catch(f){}y=new H}r=a&&"cordova"===a.adapter?A("cordova"):a&&"default"===a.adapter?A():k.Cordova||k.cordova?A("cordova"):A();if(a){"undefined"!==typeof a.checkLoginIframe&&(h.enable=a.checkLoginIframe);a.checkLoginIframeInterval&&(h.interval=a.checkLoginIframeInterval);"login-required"===a.onLoad&&(b.loginRequired=!0);if(a.responseMode)if("query"===a.responseMode||"fragment"===
a.responseMode)b.responseMode=a.responseMode;else throw"Invalid value for responseMode";if(a.flow){switch(a.flow){case "standard":b.responseType="code";break;case "implicit":b.responseType="id_token token";break;case "hybrid":b.responseType="code id_token token";break;default:throw"Invalid value for flow";}b.flow=a.flow}null!=a.timeSkew&&(b.timeSkew=a.timeSkew)}b.responseMode||(b.responseMode="fragment");b.responseType||(b.responseType="code",b.flow="standard");var e=n(),d=n();d.promise.success(function(){b.onReady&&
b.onReady(b.authenticated);e.setSuccess(b.authenticated)}).error(function(a){e.setError(a)});var l=J(m);l.success(function(){var e=D(k.location.href);if(e)return F().success(function(){k.history.replaceState({},null,e.newUrl);B(e,d)}).error(function(a){d.setError()});a?a.token&&a.refreshToken?(w(a.token,a.refreshToken,a.idToken),h.enable?F().success(function(){z().success(function(){b.onAuthSuccess&&b.onAuthSuccess();d.setSuccess()}).error(function(){w(null,null,null);d.setSuccess()})}):b.updateToken(-1).success(function(){b.onAuthSuccess&&
b.onAuthSuccess();d.setSuccess()}).error(function(){b.onAuthError&&b.onAuthError();a.onLoad?c():d.setError()})):a.onLoad?c():d.setSuccess():d.setSuccess()});l.error(function(){e.setError()});return e.promise};b.login=function(a){return r.login(a)};b.createLoginUrl=function(a){var c=I(),e=I(),d=r.redirectUri(a),l={state:c,nonce:e,redirectUri:encodeURIComponent(d)};a&&a.prompt&&(l.prompt=a.prompt);y.add(l);l="auth";a&&"register"==a.action&&(l="registrations");var f=a&&a.scope?"openid "+a.scope:"openid",
c=p()+"/protocol/openid-connect/"+l+"?client_id\x3d"+encodeURIComponent(b.clientId)+"\x26redirect_uri\x3d"+encodeURIComponent(d)+"\x26state\x3d"+encodeURIComponent(c)+"\x26nonce\x3d"+encodeURIComponent(e)+"\x26response_mode\x3d"+encodeURIComponent(b.responseMode)+"\x26response_type\x3d"+encodeURIComponent(b.responseType)+"\x26scope\x3d"+encodeURIComponent(f);a&&a.prompt&&(c+="\x26prompt\x3d"+encodeURIComponent(a.prompt));a&&a.maxAge&&(c+="\x26max_age\x3d"+encodeURIComponent(a.maxAge));a&&a.loginHint&&
(c+="\x26login_hint\x3d"+encodeURIComponent(a.loginHint));a&&a.idpHint&&(c+="\x26kc_idp_hint\x3d"+encodeURIComponent(a.idpHint));a&&a.locale&&(c+="\x26ui_locales\x3d"+encodeURIComponent(a.locale));return c};b.logout=function(a){return r.logout(a)};b.createLogoutUrl=function(a){return p()+"/protocol/openid-connect/logout?redirect_uri\x3d"+encodeURIComponent(r.redirectUri(a,!1))};b.register=function(a){return r.register(a)};b.createRegisterUrl=function(a){a||(a={});a.action="register";return b.createLoginUrl(a)};
b.createAccountUrl=function(a){return p()+"/account?referrer\x3d"+encodeURIComponent(b.clientId)+"\x26referrer_uri\x3d"+encodeURIComponent(r.redirectUri(a))};b.accountManagement=function(){return r.accountManagement()};b.hasRealmRole=function(a){var c=b.realmAccess;return!!c&&0<=c.roles.indexOf(a)};b.hasResourceRole=function(a,c){if(!b.resourceAccess)return!1;c=b.resourceAccess[c||b.clientId];return!!c&&0<=c.roles.indexOf(a)};b.loadUserProfile=function(){var a=p()+"/account",c=new XMLHttpRequest;
c.open("GET",a,!0);c.setRequestHeader("Accept","application/json");c.setRequestHeader("Authorization","bearer "+b.token);var e=n();c.onreadystatechange=function(){4==c.readyState&&(200==c.status?(b.profile=JSON.parse(c.responseText),e.setSuccess(b.profile)):e.setError())};c.send();return e.promise};b.loadUserInfo=function(){var a=p()+"/protocol/openid-connect/userinfo",c=new XMLHttpRequest;c.open("GET",a,!0);c.setRequestHeader("Accept","application/json");c.setRequestHeader("Authorization","bearer "+
b.token);var e=n();c.onreadystatechange=function(){4==c.readyState&&(200==c.status?(b.userInfo=JSON.parse(c.responseText),e.setSuccess(b.userInfo)):e.setError())};c.send();return e.promise};b.isTokenExpired=function(a){if(!b.tokenParsed||!b.refreshToken&&"implicit"!=b.flow)throw"Not authenticated";if(null==b.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var c=b.tokenParsed.exp-Math.ceil((new Date).getTime()/1E3)+b.timeSkew;a&&(c-=a);return 0>
c};b.updateToken=function(a){var c=n();if(!b.refreshToken)return c.setError(),c.promise;a=a||5;var e=function(){var d=!1;if(-1==a)d=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh");else if(!b.tokenParsed||b.isTokenExpired(a))d=!0,console.info("[KEYCLOAK] Refreshing token: token expired");if(d){var d="grant_type\x3drefresh_token\x26refresh_token\x3d"+b.refreshToken,e=p()+"/protocol/openid-connect/token";u.push(c);if(1==u.length){var f=new XMLHttpRequest;f.open("POST",e,!0);f.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");f.withCredentials=!0;b.clientId&&b.clientSecret?f.setRequestHeader("Authorization","Basic "+btoa(b.clientId+":"+b.clientSecret)):d+="\x26client_id\x3d"+encodeURIComponent(b.clientId);var g=(new Date).getTime();f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){console.info("[KEYCLOAK] Token refreshed");g=(g+(new Date).getTime())/2;var a=JSON.parse(f.responseText);w(a.access_token,a.refresh_token,a.id_token,g);b.onAuthRefreshSuccess&&b.onAuthRefreshSuccess();
for(a=u.pop();null!=a;a=u.pop())a.setSuccess(!0)}else for(console.warn("[KEYCLOAK] Failed to refresh token"),b.onAuthRefreshError&&b.onAuthRefreshError(),a=u.pop();null!=a;a=u.pop())a.setError(!0)};f.send(d)}}else c.setSuccess(!1)};h.enable?z().success(function(){e()}).error(function(){c.setError()}):e();return c.promise};b.clearToken=function(){b.token&&(w(null,null,null),b.onAuthLogout&&b.onAuthLogout(),b.loginRequired&&b.login())};b.callback_id=0;var G=function(){function a(){for(var a=(new Date).getTime(),
b=0;b<localStorage.length;b++){var d=localStorage.key(b);if(d&&0==d.indexOf("kc-callback-")){var l=localStorage.getItem(d);if(l)try{var f=JSON.parse(l).expires;(!f||f<a)&&localStorage.removeItem(d)}catch(g){localStorage.removeItem(d)}}}}if(!(this instanceof G))return new G;localStorage.setItem("kc-test","test");localStorage.removeItem("kc-test");this.get=function(b){if(b){b="kc-callback-"+b;var c=localStorage.getItem(b);c&&(localStorage.removeItem(b),c=JSON.parse(c));a();return c}};this.add=function(b){a();
var c="kc-callback-"+b.state;b.expires=(new Date).getTime()+36E5;localStorage.setItem(c,JSON.stringify(b))}},H=function(){if(!(this instanceof H))return new H;this.get=function(c){if(c){var d;a:{d="kc-callback-"+c+"\x3d";for(var e=document.cookie.split(";"),f=0;f<e.length;f++){for(var g=e[f];" "==g.charAt(0);)g=g.substring(1);if(0==g.indexOf(d)){d=g.substring(d.length,g.length);break a}}d=""}b("kc-callback-"+c,"",a(-100));if(d)return JSON.parse(d)}};this.add=function(c){b("kc-callback-"+c.state,JSON.stringify(c),
a(60))};this.removeItem=function(c){b(c,"",a(-100))};var a=function(a){var b=new Date;b.setTime(b.getTime()+6E4*a);return b},b=function(a,b,c){a=a+"\x3d"+b+"; expires\x3d"+c.toUTCString()+"; ";document.cookie=a}},E=function(a,b){if(!(this instanceof E))return new E(a,b);var c=function(a){var b={};a=a.split("\x26");for(var c=0;c<a.length;c++){var d=a[c].split("\x3d"),e=decodeURIComponent(d[0]),d=decodeURIComponent(d[1]);b[e]=d}return b};this.parseUri=function(){var d,e,f,g=null;f=null;e=a.indexOf("?");
var h=a.indexOf("#",e+1);-1==e&&-1==h?d=a:-1!=e?(d=a.substring(0,e),g=a.substring(e+1),-1!=h&&(h=g.indexOf("#"),f=g.substring(h+1),g=g.substring(0,h))):(d=a.substring(0,h),f=a.substring(h+1));e=g;g={};e&&(g=c(e));d={newUrl:d};for(var k in g)switch(k){case "redirect_fragment":d.fragment=g[k];break;default:if(!(e="query"!=b)){a:{e=k;for(var h=g[k],n=d,m=["code","state","error","error_description"],p=0;p<m.length;p++)if(e===m[p]){n[e]=h;e=!0;break a}e=!1}e=!e}e&&(d.newUrl+=(-1==d.newUrl.indexOf("?")?
"?":"\x26")+k+"\x3d"+encodeURIComponent(g[k]))}if("fragment"===b)for(k in g={},f&&(g=c(f)),g)d[k]=g[k];return d}}};"object"===typeof module&&module&&"object"===typeof module.exports?module.exports=x:(k.Keycloak=x,"function"===typeof define&&define.amd&&define("keycloak",[],function(){return x}))})(window);
//# sourceMappingURL=keycloak.min.js.map